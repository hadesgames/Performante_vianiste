<html>
<head>
  
  <link rel="stylesheet" type="text/css" href="/sever/static/css/style.css">
  <link rel="stylesheet" type="text/css" href="/sever/static/css/timer.css">
  <script src="/sever/static/dojo/dojo.js" data-dojo-config="isDebug: true,parseOnLoad: true"></script>
  <script src="/sever/static/js/timer.js"></script>
  <script src="/sever/static/js/init.js"/></script>

  <script>
    function problems_display_refresh(data)
    {
      for (id in data)
      {
        if (data[id].score != dojo.byId("row_score_"+id).innerHTML)
        {
          dojo.byId("row_score_"+id).innerHTML = data[id].score;
          dojo.animateProperty({
                  node: dojo.byId("row_filler_"+id),
                  properties: { width : data[id].score }}).play();
        }
      }

    }
    function problems_display_init(data){
 //     alert(data);
      problem_list = dojo.byId("problem_list");
      for (id in data)
      {
        li=dojo.create("li", { class: "row" ,id:"row_"+id },problem_list);
        name_div=dojo.create("div",{ class: "name" },li);
        dojo.create("p",{class:"p_name",
                        innerHTML: data[id].name},name_div);

  
        if (id % 2==0)
          color="green";
        else
          color="blue";
        bar_div=dojo.create("div",{class: color},li);

        dojo.create("div",{class:"left_filler",
                           innerHTML:"&nbsp;"},bar_div);

        dojo.create("div",{class:"filler",
                           id: "row_filler_"+id,
                           innerHTML:"&nbsp;",
                           style:"width: "+data[id].score+"px;"},bar_div);
        dojo.create("div",{class:"right_filler",
                           innerHTML:"&nbsp;"},bar_div);
        dojo.create("p",{class:"score",id:"row_score_"+id,innerHTML: data[id].score},bar_div);

      }
      
    }

    
    function problems_refresh_init()
    {
      dojo.xhrGet({
            url: "/sever/api/problems/1",
            handleAs: "json",
            load: problems_display_init,
            error: function (){ alert("QQ");} });
    }
    function problems_refresh(){
      dojo.xhrGet({
            url: "/sever/api/problems/1",
            handleAs: "json",
            load: problems_display_refresh});

    }
    function problems_init(){

      dojo.require("dojox.timing")
      var t = new dojox.timing.Timer(3000);
      t.onStart = problems_refresh_init;
      t.onTick = problems_refresh;
      t.start()
    }
    dojo.ready(function(){
        timer_init();
        problems_init();
        });
  </script>
</head>
<body>
{% include "timer.html" %}
<ul id = "problem_list" style="list-style-type:None">
</ul>
</html>
